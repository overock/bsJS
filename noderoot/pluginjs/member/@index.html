<%if( bs.WEB.method() == 'POST' ){
	var p = parseInt( bs.WEB.post( 'p' ), 10 );
	if( p < 1 ) p = 1;
	return bs.WEB.application('db')( 'Plist', ['p', ( p - 1 ) * 10, 'rpp', 10, 'id', bs.WEB.session('id')] );
}%>

<%IMPORT( '@head.html' );%>
<!--<div id="add" style="display:none">-->
    <!--<table cellspacing="0" border="0" cellpadding="0">-->
        <!--<tr height="35px">-->
            <!--<td style="background:#54597c;padding:0px 10px 0px 15px;color:#fff">title</td><td style="background:#fff"><input type="text" id="Atitle" /></td>-->
            <!--<td style="background:#54597c;padding:0px 10px 0px 15px;color:#fff">uniquename</td><td style="background:#fff"><input type="text" id="Auname" /></td>-->
            <!--<td style="background:#54597c;padding:0px 10px 0px 15px;color:#fff">type</td><td style="background:#fff"><select id="Atype"><option value="1">method</option><option value="2">class</option><option value="3">static</option></select></td>-->
            <!--<td style="background:#54597c;padding:0px 10px 0px 15px;color:#fff">category</td><td style="background:#fff"><select id="Acat">-->
                <!--<%for( var t0 = bs.WEB.application( 'cat' ), i = 0, j = t0.length; i < j ; i++ ){%>-->
                <!--<option value="<%=t0[i].cat_rowid%>"><%=t0[i].title%></option>-->
                <!--<%}%>-->
            <!--</select></td>-->
        <!--</tr>-->
        <!--<tr height="10px"></tr>-->
        <!--<tr height="35px"><td colspan="8" style="background:#54597c;padding:0px 10px 0px 10px;color:#fff">description</td></tr>-->
        <!--<tr ><td colspan="8"><textarea id="Adescription" style="width:900px;height:250px"></textarea></td></tr>-->
        <!--<tr height="35px"><td colspan="1" style="background:#54597c;padding:0px 10px 0px 10px;color:#fff">keyword</td><td colspan="7" style="background:#fff"> <input type="text" id="Akeyword" /></td></tr>-->
        <!--<tr height="10px"></tr>-->
        <!--<tr height="35px"><td colspan="1" style="background:#54597c;padding:0px 10px 0px 10px;color:#fff">thumb url</td><td colspan="7" style="background:#fff"><input type="text" id="Athumb" /></td></tr>-->
    <!--</table>-->
    <!--<input type="button" id="Aadd" value="add" style=""/> <input type="button" id="Acancel" value="cancel" style=""/>-->
<!--</div>-->
<div id="add" style="display:none;overflow:hidden ">
    레지스터 타이틀들어감(헤더부분을 수정해야할듯)
    <div style="width:850px; margin:auto;padding-top:50px">
	<div class="title">title</div>
    <div><input type="text" id="Atitle" class="value" /></div>
    <div class="title" >uniquename</div>
    <div><input type="text" id="Auname" class="value"/></div>
    <div  class="title">type</div>
    <div><select id="Atype" class="value">
        <%for( var t0 = bs.WEB.application( 'type' ), i = 0, j = t0.length; i < j ; i++ ){%>
        <option value="<%=t0[i].plugintype_rowid%>"><%=t0[i].title%></option>
        <%}%>
    </select></div>
    <div class="title" >category</div>
    <div> <select id="Acat" class="value">
        <%for( var t0 = bs.WEB.application( 'cat' ), i = 0, j = t0.length; i < j ; i++ ){%>
        <option value="<%=t0[i].cat_rowid%>"><%=t0[i].title%></option>
        <%}%>
    </select></div>
    <div style="clear:both;background:#54597c;color:#fff; padding:10px 10px 10px 10px; float:left;  width:80px;margin-top:2px">description</div>
    <div><textarea id="Adescription" style="background:#fff;padding:5px;border:0px;margin-top:2px; width:800px; height:200px"></textarea></div>
	<div class="title2">keyword</div>
    <div ><input type="text" id="Akeyword" class="value2"/></div>
	<div class="title2">thumb url</div>
    <div ><input type="text" id="Athumb" class="value2"/></div>
	<div id="Aalert"></div>
	<input type="button" id="Aadd" value="add"/> <input type="button" id="Acancel" value="cancel"/>
    </div>
</div>
<div id="pgMiddleVisual">
    <div id="visualEffect"></div>
    <script>bs( site.mainVisual );</script>
    <img src="../res/member/title.png" style="position:absolute; margin-top:100px;margin-left:60px">
</div>
<div id='idBox' style="margin:-200px 0px 80px 60px;position:relative">
    <table cellspacing="0" border="0" cellpadding="0">
        <tr><td rowspan="4" width="115"><img src="../res/draft/index_Bthumb_1.png" height="100" width="100" style="border-radius:10px"></td><td style="font-size:20px;font-weight:bold"><%=bs.WEB.session('nick')%>'s plugin</td></tr>
        <tr><td><%=bs.WEB.session('email')%></td></tr>
        <tr><td><div id="Padd" class="add"><span class="batch">&#xF14C;</span> Add New Plugin</div></td></tr>
    </table>
</div>
<div id="list">
	<table cellspacing="0" border="0" cellpadding="0" style="width:980px"><tr>
	<td style="border-radius:15px 0 0 15px;width:500px" class="tableHead">Title</td><td style="width:150px" class="tableHead">Type</td>
	<td style="width:150px" class="tableHead">Category</td><td style="border-radius:0 15px 15px 0" class="tableHead">Date</td>
	</tr></table>
	<div id="Plist" class="mlist"></div>
	<div id="Ppage"></div>
</div>
<script>
bs( function(){
	var page;
	function list( $page ){
		var t0, t1, i, j;
		page = $page, t0 = JSON.parse( bs.$post( null, '/member/', 'p', page ) );
		if( t0.result == 'ok' ){
            t0 = t0.contents, i = 0, j = t0.length,
                    t1 = '<table cellspacing="0" border="0" cellpadding="0" style="width:980px">'+
                            '<colgroup><col style="width:20px"/><col/><col style="width:380px"/><col style="width:160px"/><col style="width:150px"/><col/></colgroup>';
            for( ; i < j ; i++ )
                t1 += '<tr style="text-align:center; height:125px"><td></td><td width="100"><img src="../res/draft/index_Bthumb_1.png" style="width:72px;border-radius:5px"></td><td style="text-align:left;font-weight:normal;font-size:22px">'+
                        '<a href="/member/view?r='+t0[i].plugin_rowid+'">'+t0[i].title+'</a><br/><div style="background:#81acb3;border-radius:15px;margin-top:5px;padding:2px 10px 2px 10px;color:#fff;font-size:11px;float:left">'+t0[i].uname+'</div><div style="background:#757dae;border-radius:15px;margin:5px 5px 0px 5px;padding:2px 10px 2px 10px;color:#fff;font-size:11px;float:left">Hit 2,000 / Like 1,324</div>' +
                        '<img src="../res/member/icon_fix.png" style="margin:5px 5px 0px 0px; opacity:0.3"><img src="../res/member/icon_view.png" style="opacity:0.3"> </td>'+
                        '<td style="font-size:12px;font-weight:normal;color:#bfbec6">'+t0[i].type.charAt(0).toUpperCase()+t0[i].type.substr(1)+'</td><td style="font-size:12px;font-weight:normal;color:#bfbec6">'+t0[i].cat+'</td><td style="font-size:12px;color:#404040">'+t0[i].regdate+'</td></tr>';
            t1 += '</table>';
		}else t1 = 'No Registered Plugin';
		bs.dom( '#Plist' ).$( 'html', t1 );
	}
	list(1);
	bs.dom( '#Padd' ).$( 'down', function(){
		bs.dom( '#list' ).$( 'display', 'none' );
		bs.dom( '#add' ).$( 'display', 'block' );
        bs.ANI.tween( bs.dom( '#add').$('height',0,'this'), 'height', 500, 'time', 1, 'ease','circleInOut');
	} );
	bs.dom( '#Aadd' ).$( 'down', function( $e ){
		var t0;
		t0 = bs.$post( null, '/member/add', 
			'type', bs.dom( '#Atype' ).$('@value'), 'uname', bs.dom( '#Auname' ).$('@value'),
			'title', bs.dom( '#Atitle' ).$('@value'), 'description', bs.dom( '#Adescription' ).$('@value'),
			'cat', bs.dom( '#Acat' ).$('@value'), 'keyword', bs.dom( '#Akeyword' ).$('@value'),
			'thumb', bs.dom( '#Athumb' ).$('@value')
		);
		if( t0 ){
			t0 = JSON.parse( t0 );
			if( t0.result == 'ok' ){
				list(page);
				bs.dom( '#add' ).$( 'display', 'none' );
				bs.dom( '#list' ).$( 'display', 'block' );
			}else{
				bs.dom( '#Aalert' ).$( 'html', 'addFailed:'+ t0.contents );
			}
		}else{
			bs.dom( '#Aalert' ).$( 'html', 'addFailed: no response' );
		}
	} );
	bs.dom( '#Acancel' ).$( 'down', function( $e ){
		bs.dom( '#add' ).$( 'display', 'none' );
		bs.dom( '#list' ).$( 'display', 'block' );
	} );
} );
</script>
<%IMPORT( '@foot.html' );%>
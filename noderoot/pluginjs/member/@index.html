<%if( bs.WEB.method() == 'POST' ){
	var p = parseInt( bs.WEB.post( 'p' ), 10 );
	if( p < 1 ) p = 1;
	return bs.WEB.application('db')( 'Plist', ['p', ( p - 1 ) * 10, 'rpp', 10, 'id', bs.WEB.session('id')] );
}%>

<%IMPORT( '@head.html' );%>
<div id="add" style="display:none;overflow:hidden;">
    <div style="width:856px;height:350px; margin:30px auto;padding:30px;background:#fff;border-radius:10px;border:1px solid #eee;box-shadow:2px 2px 2px 2px rgba(50, 50, 50, 0.05)">
    <div><img src="../res/member/plugin_reg.png"></div>
	<div class="title"><%=bs.WEB.application('txt')('pluginAdd','title')%></div>
    <div><input type="text" id="Atitle" class="value" /></div>
    <div class="title" ><%=bs.WEB.application('txt')('pluginAdd','unique')%></div>
    <div><input type="text" id="Auname" class="value"/></div>
    <div  class="title"><%=bs.WEB.application('txt')('pluginAdd','type')%></div>
    <div><select id="Atype" class="value">
    <%for( var t0 = bs.WEB.application( 'type' ), i = 0, j = t0.length; i < j ; i++ ){%>
    <option value="<%=t0[i].plugintype_rowid%>"><%=t0[i].title%></option>
    <%}%>
    </select></div>
    <div class="title" ><%=bs.WEB.application('txt')('pluginAdd','category')%></div>
    <div> <select id="Acat" class="value">
    <%for( var t0 = bs.WEB.application( 'cat' ), i = 0, j = t0.length; i < j ; i++ ){%>
    <option value="<%=t0[i].cat_rowid%>"><%=t0[i].title%></option>
    <%}%>
    </select></div>
    <div class="title"><%=bs.WEB.application('txt')('pluginAdd','keyword')%></div>
    <div ><input type="text" id="Akeyword" class="value"/></div>
    <div style="position:relative;margin:-320px 0px 0px 330px">
        <div class="title" style="margin-top:19px; float:left;  width:80px;font-size:14px;font-weight:bold"><%=bs.WEB.application('txt')('pluginAdd','description')%></div>
        <div><textarea id="Adescription" style="padding:5px;width:98%; height:150px;" class="value"></textarea></div>
        <div><img src="../res/draft/index_Bthumb_1.png" width="105" style="border-radius:10px;margin-top:10px"> </div>
        <div class="title" style="margin:-100px 0px 0px 120px"><%=bs.WEB.application('txt')('pluginAdd','thumb')%></div>
        <div style="margin:-25px 0px 0px 210px;"><input type="text" id="Athumb" class="value" style="width:305px"/></div>
        <div style="margin:8px 0px 0px 122px"><%=bs.WEB.application('txt')('pluginAdd','rthumb')%> : 200*200</div>
        <div id="Aalert" style="margin-left:120px"></div>
        <input type="button" id="Aadd" value="Add Plugin" class="add" style="border:1px solid #eee;font-size:12px;margin:10px 3px 0px 120px;width:199px"/> <input type="button" id="Acancel" value="cancel" class="add" style="border:1px solid #eee;font-size:12px;width:200px"/>
    </div>
    </div>
</div>
<!--<div id="add" style="display:none;overflow:hidden;">-->
    <!--<div style="width:856px; margin:auto;padding:20px;background:#fff;border-radius:10px">-->
        <!--<div><img src="../res/member/plugin_reg.png"></div>-->
        <!--<div class="title">TITLE</div>-->
        <!--<div><input type="text" id="Atitle" class="value" /></div>-->
        <!--<div class="title" >UNIQUE NAME</div>-->
        <!--<div><input type="text" id="Auname" class="value"/></div>-->
        <!--<div  class="title">TYPE</div>-->
        <!--<div><select id="Atype" class="value">-->
            <!--<%for( var t0 = bs.WEB.application( 'type' ), i = 0, j = t0.length; i < j ; i++ ){%>-->
            <!--<option value="<%=t0[i].plugintype_rowid%>"><%=t0[i].title%></option>-->
            <!--<%}%>-->
        <!--</select></div>-->
        <!--<div class="title" >CATEGORY</div>-->
        <!--<div> <select id="Acat" class="value">-->
            <!--<%for( var t0 = bs.WEB.application( 'cat' ), i = 0, j = t0.length; i < j ; i++ ){%>-->
            <!--<option value="<%=t0[i].cat_rowid%>"><%=t0[i].title%></option>-->
            <!--<%}%>-->
        <!--</select></div>-->
        <!--<div style="clear:both; padding:10px 10px 10px 10px; float:left;  width:80px;margin-top:10px;font-size:14px;font-weight:bold">description</div>-->
        <!--<div><textarea id="Adescription" style="padding:5px;margin:2px 0px 10px 0px; width:870px; height:200px;float:none" class="value"></textarea></div>-->
        <!--<div class="title2">keyword</div>-->
        <!--<div ><input type="text" id="Akeyword" class="value"/></div>-->
        <!--<div class="title2">thumb url</div>-->
        <!--<div ><input type="text" id="Athumb" class="value"/></div>-->
        <!--<div id="Aalert"></div>-->
        <!--<input type="button" id="Aadd" value="add"/> <input type="button" id="Acancel" value="cancel"/>-->
    <!--</div>-->
<!--</div>-->
<div id="pgMiddleVisual">
    <div id="visualEffect"></div>
    <script>bs( site.mainVisual );</script>
    <img src="../res/member/title.png" style="position:absolute; margin-top:50px;margin-left:60px">
</div>
<div id='idBox' style="margin:-150px 0px 50px 60px;position:relative">
    <table cellspacing="0" border="0" cellpadding="0">
        <tr><td rowspan="4" width="115"><img src="../res/draft/index_Bthumb_1.png" height="100" width="100" style="border-radius:10px"></td><td style="font-size:20px;font-weight:bold"><%=bs.WEB.session('nick')%>'s plugin</td></tr>
        <tr><td><%=bs.WEB.session('email')%></td></tr>
        <tr><td><div id="Padd" class="add"><span class="batch">&#xF14C;</span><%=bs.WEB.application('txt')('pluginAdd','addPlugin')%></div></td></tr>
    </table>
</div>
<div id="list">
	<table cellspacing="0" border="0" cellpadding="0" style="width:980px"><tr>
	<td style="border-radius:15px 0 0 15px;width:500px" class="tableHead"><%=bs.WEB.application('txt')('pluginAdd','title')%></td><td style="width:150px" class="tableHead"><%=bs.WEB.application('txt')('pluginAdd','type')%></td>
	<td style="width:150px" class="tableHead"><%=bs.WEB.application('txt')('pluginAdd','category')%></td><td style="border-radius:0 15px 15px 0" class="tableHead"><%=bs.WEB.application('txt')('pluginAdd','date')%></td>
	</tr></table>
	<div id="Plist" class="mlist"></div>
	<div id="Ppage"></div>
</div>
<script>
bs( function(){
	var page;
	function list( $page ){
		var t0, t1, i, j;
		page = $page, t0 = JSON.parse( bs.$post( null, '/member/', 'p', page ) );
		if( t0.result == 'ok' ){
            t0 = t0.contents, i = 0, j = t0.length,
                    t1 = '<table cellspacing="0" border="0" cellpadding="0" style="width:980px">'+
                            '<colgroup><col style="width:20px"/><col/><col style="width:380px"/><col style="width:160px"/><col style="width:150px"/><col/></colgroup>';
            for( ; i < j ; i++ )
                t1 += '<tr style="text-align:center; height:125px"><td></td><td width="100"><img src="../res/draft/index_Bthumb_1.png" style="width:72px;border-radius:5px"></td><td style="text-align:left;font-weight:normal;font-size:22px">'+
                        '<a href="/member/view?r='+t0[i].plugin_rowid+'">'+t0[i].title+'</a><br/><div style="background:#81acb3;border-radius:15px;margin-top:5px;padding:2px 10px 2px 10px;color:#fff;font-size:11px;float:left">'+t0[i].uname+'</div><div style="background:#757dae;border-radius:15px;margin:5px 5px 0px 5px;padding:2px 10px 2px 10px;color:#fff;font-size:11px;float:left">Hit 2,000 / Like 1,324</div>' +
                        '<img src="../res/member/icon_fix.png" style="margin:5px 5px 0px 0px; opacity:0.3"><img src="../res/member/icon_view.png" style="opacity:0.3"> </td>'+
                        '<td style="font-size:12px;font-weight:normal;color:#bfbec6">'+t0[i].type.charAt(0).toUpperCase()+t0[i].type.substr(1)+'</td><td style="font-size:12px;font-weight:normal;color:#bfbec6">'+t0[i].cat+'</td><td style="font-size:12px;color:#404040">'+t0[i].regdate+'</td></tr>';
            t1 += '</table>';
		}else t1 = 'No Registered Plugin';
		bs.dom( '#Plist' ).$( 'html', t1 );
	}
	list(1);
	bs.dom( '#Padd' ).$( 'down', function(){
		bs.dom( '#list' ).$( 'display', 'none' );
		bs.dom( '#add' ).$( 'display', 'block' );
        bs.dom( '#pgMiddleVisual' ).$( 'display', 'none' );
        bs.dom( '#idBox' ).$( 'display', 'none' );
        bs.ANI.tween( bs.dom( '#add').$('height',0,'this'), 'height', 500, 'time', 0.5, 'ease','circleInOut');
	} );
	bs.dom( '#Aadd' ).$( 'down', function( $e ){
		var t0;
		t0 = bs.$post( null, '/member/add', 
			'type', bs.dom( '#Atype' ).$('@value'), 'uname', bs.dom( '#Auname' ).$('@value'),
			'title', bs.dom( '#Atitle' ).$('@value'), 'description', bs.dom( '#Adescription' ).$('@value'),
			'cat', bs.dom( '#Acat' ).$('@value'), 'keyword', bs.dom( '#Akeyword' ).$('@value'),
			'thumb', bs.dom( '#Athumb' ).$('@value')
		);
		if( t0 ){
			t0 = JSON.parse( t0 );
			if( t0.result == 'ok' ){
				list(page);
				bs.dom( '#add' ).$( 'display', 'none' );
				bs.dom( '#list' ).$( 'display', 'block' );
                bs.dom( '#pgMiddleVisual' ).$( 'display', 'block' );
                bs.dom( '#idBox' ).$( 'display', 'block' );
			}else{
				bs.dom( '#Aalert' ).$( 'html', 'addFailed:'+ t0.contents );
			}
		}else{
			bs.dom( '#Aalert' ).$( 'html', 'addFailed: no response' );
		}
	} );
	bs.dom( '#Acancel' ).$( 'down', function( $e ){
		bs.dom( '#add' ).$( 'display', 'none' );
		bs.dom( '#list' ).$( 'display', 'block' );
        bs.dom( '#pgMiddleVisual' ).$( 'display', 'block' );
        bs.dom( '#idBox' ).$( 'display', 'block' );
	} );
} );
</script>
<%IMPORT( '@foot.html' );%>